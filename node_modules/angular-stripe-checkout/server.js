var fs = require("fs"),
    http = require("http"),
    path = require("path");

var MIME_TYPES = {
  html: "text/html",
  js: "application/javascript"
};

var httpd = http.createServer(function(req, res) {
  var relPath = req.url.substring(1),
      extension = path.extname(relPath),
      file = fs.createReadStream(relPath),
      mimeType;

  file.on("error",function(err) {
    if (err.code === "ENOENT") {
      res.writeHead(404,{ "Content-Type": "text/plain" });
      res.end("Not Found");
    } else {
      res.writeHead(500,{ "Content-Type": "text/plain" });
      res.end(err.stack || err.message || err.toString());
    }
  });

  if (extension)
    mimeType = MIME_TYPES[extension.substring(1)];
  else
    mimeType = "text/plain";

  file.once("data",function() {
    res.writeHead(200,{ "Content-Type": mimeType });
  });

  file.pipe(res);
});

httpd.listen(process.argv[2] || 8080);
